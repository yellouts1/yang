<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¬ê¸°ë¡œìš´ ì ˆì£¼ìƒí™œ ê°€ì´ë“œ</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë° íƒœë¸”ë¦¿ ìµœì í™” */
        body { font-family: 'Malgun Gothic', 'Arial', sans-serif; margin: 0; padding: 0; background-color: #f0f4f8; display: flex; flex-direction: column; height: 100vh; }
        .app-header { background-color: #007bff; color: white; padding: 15px 20px; text-align: center; font-size: 1.5em; font-weight: bold; }
        .tabs { display: flex; justify-content: space-around; background-color: #e9ecef; border-bottom: 3px solid #dee2e6; }
        .tab-button { flex-grow: 1; padding: 15px 0; text-align: center; cursor: pointer; font-size: 1.1em; color: #495057; transition: background-color 0.3s; border-right: 1px solid #dee2e6; }
        .tab-button:last-child { border-right: none; }
        .tab-button.active { background-color: white; color: #007bff; border-bottom: 3px solid #007bff; font-weight: bold; }
        
        .tab-content { padding: 30px 40px; flex-grow: 1; overflow-y: auto; background-color: white; display: none; }
        .tab-content.active { display: block; }

        /* ê³µí†µ ì»´í¬ë„ŒíŠ¸ ìŠ¤íƒ€ì¼ */
        h2 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 5px; font-size: 1.8em; }
        /* ë³´ê±´ì†Œ ë¬¸êµ¬ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .health-center-info { font-size: 1em; color: #6c757d; margin-bottom: 20px; display: block; text-align: center; }
        
        .question-box { background-color: #f8f9fa; border: 1px solid #e9ecef; border-radius: 10px; padding: 25px; margin-bottom: 20px; }
        .question-box p { font-size: 1.3em; margin-bottom: 20px; font-weight: bold; color: #343a40; }
        .options button { display: block; width: 100%; padding: 15px; margin-bottom: 12px; background-color: #e9ecef; border: 1px solid #ced4da; border-radius: 8px; font-size: 1.1em; cursor: pointer; text-align: left; transition: background-color 0.2s, border-color 0.2s; }
        .options button:hover { background-color: #dee2e6; }
        .options button.selected { background-color: #007bff; color: white; border-color: #007bff; }
        .result-message { margin-top: 20px; padding: 15px; border-radius: 8px; font-size: 1.2em; font-weight: bold; text-align: center; }
        .result-message.correct { background-color: #d4edda; color: #155724; }
        .result-message.incorrect { background-color: #f8d7da; color: #721c24; }
        .rationale { margin-top: 15px; padding: 15px; border-left: 5px solid #ffc107; background-color: #fff3cd; font-size: 1em; }
        .action-container { margin-top: 30px; text-align: right; }
        .next-btn, .finish-btn { padding: 15px 30px; border: none; border-radius: 8px; font-size: 1.2em; cursor: pointer; margin-left: 10px; }
        .next-btn { background-color: #28a745; color: white; }
        .finish-btn { background-color: #dc3545; color: white; }
        
        /* AUDIT íŠ¹ì • ìŠ¤íƒ€ì¼ */
        .gender-select button { padding: 15px 30px; margin: 15px; font-size: 1.2em; border: 2px solid #007bff; background-color: #ffffff; border-radius: 8px; cursor: pointer; }
        .gender-select button.selected { background-color: #007bff; color: white; }

        /* ì„œì•½ íƒ­ íŠ¹ì • ìŠ¤íƒ€ì¼ */
        #pledge-date { font-size: 1.2em; color: #6c757d; margin-bottom: 20px; display: block; text-align: center; }
        .pledge-goal-select { max-width: 600px; margin: 0 auto 30px; }
        .pledge-goal-select label { font-size: 1.1em; display: block; margin-bottom: 10px; font-weight: bold; }
        .pledge-goal-select select { padding: 12px; font-size: 1em; width: 100%; border-radius: 5px; border: 1px solid #ced4da; }
        .pledge-statement { border: 2px dashed #007bff; padding: 25px; margin: 30px 0; font-size: 1.3em; line-height: 1.6; text-align: center; background-color: #eaf3ff; }
        #signature-canvas { border: 2px solid #ced4da; border-radius: 8px; background-color: #ffffff; cursor: crosshair; display: block; width: 100%; height: 150px; }
        .signature-actions { margin-top: 15px; text-align: right; }
        .signature-actions button { background-color: #ffc107; color: #343a40; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px; font-weight: bold; }
        .pledge-submit-btn { background-color: #28a745; color: white; padding: 15px 30px; border: none; border-radius: 8px; font-size: 1.2em; width: 100%; margin-top: 20px; cursor: pointer; }
        .complete-message { text-align: center; padding: 40px; background-color: #d1e7dd; color: #0f5132; border: 1px solid #badbcc; border-radius: 10px; font-size: 1.5em; font-weight: bold; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
</head>
<body>
    <div class="app-header">
        ìŠ¬ê¸°ë¡œìš´ ì ˆì£¼ìƒí™œ ê°€ì´ë“œ
    </div>
    
    <div class="tabs">
        <div class="tab-button active" onclick="openTab(event, 'quiz')">ğŸ¥‡ ìŒì£¼ ìƒì‹ í€´ì¦ˆ</div>
        <div class="tab-button" onclick="openTab(event, 'audit')">ğŸ”¬ ì•Œì½”ì˜¬ ì¤‘ë… ì„ ë³„ê²€ì‚¬(AUDIT)</div>
        <div class="tab-button" onclick="openTab(event, 'pledge')">âœï¸ ì ˆì£¼ ì„œì•½</div>
    </div>
    
    <div id="quiz" class="tab-content active">
        <h2>ìŒì£¼ ìƒì‹ í€´ì¦ˆ</h2>
        <span class="health-center-info">ì œì£¼ì‹œ ì œì£¼ë³´ê±´ì†Œ</span>
        <div id="quiz-container">
            </div>
        <div id="quiz-final-result" style="display: none;">
            </div>
    </div>
    
    <div id="audit" class="tab-content">
        <h2>ì•Œì½”ì˜¬ ì¤‘ë… ì„ ë³„ê²€ì‚¬ (AUDIT)</h2>
        <span class="health-center-info">ì œì£¼ì‹œ ì œì£¼ë³´ê±´ì†Œ</span>
        <div id="audit-intro">
            <p style="font-size: 1.2em; text-align: center; margin-bottom: 30px;">ì •í™•í•œ ê²°ê³¼ë¥¼ ìœ„í•´ **ì„±ë³„**ì„ ë¨¼ì € ì„ íƒí•´ ì£¼ì„¸ìš”.</p>
            <div class="gender-select" style="text-align: center;">
                <button id="gender-male" onclick="setGender('M', this)">ğŸ‘¨ ë‚¨ì„±</button>
                <button id="gender-female" onclick="setGender('F', this)">ğŸ‘© ì—¬ì„±</button>
            </div>
        </div>
        <div id="audit-container" style="display: none;">
            </div>
        <div id="audit-final-result" style="display: none;">
            </div>
    </div>
    
    <div id="pledge" class="tab-content">
        <h2>ë‚˜ì˜ ê±´ê°•ì„ ìœ„í•œ ì ˆì£¼ ì„œì•½</h2>
        <span class="health-center-info">ì œì£¼ì‹œ ì œì£¼ë³´ê±´ì†Œ</span>
        <div id="pledge-complete-message" class="complete-message" style="display: none;"></div>
        <div id="pledge-form">
            <label id="pledge-date"></label>

            <div class="pledge-goal-select">
                <label for="goal-select">ë‚˜ì˜ ì ˆì£¼ ëª©í‘œë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”:</label>
                <select id="goal-select">
                    <option value="ì™„ì „ ê¸ˆì£¼">âœ… ì™„ì „ ê¸ˆì£¼ (ìˆ ì„ ëŠê² ìŠµë‹ˆë‹¤)</option>
                    <option value="ì£¼ 1íšŒ ì´í•˜ ìŒì£¼">ğŸ“… ì£¼ 1íšŒ ì´í•˜ ìŒì£¼</option>
                    <option value="ì›” 2íšŒ ì´í•˜ ìŒì£¼">ğŸ—“ï¸ ì›” 2íšŒ ì´í•˜ ìŒì£¼</option>
                    <option value="ë§¥ì£¼ 500cc 1ìº” ì´í•˜">ğŸº ìŒì£¼ ì‹œ ë§¥ì£¼ 500cc 1ìº” ì´í•˜</option>
                </select>
            </div>
            
            <div class="pledge-name-input" style="max-width: 600px; margin: 20px auto 30px;">
                <label for="signer-name">ì„œì•½ì ì´ë¦„/ë³„ëª…:</label>
                <input type="text" id="signer-name" placeholder="ì´ë¦„ ë˜ëŠ” ë³„ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" style="padding: 12px; font-size: 1em; width: 100%; border-radius: 5px; border: 1px solid #ced4da;">
            </div>
            <div class="pledge-statement">
                ë‚˜ëŠ” ë‚˜ì˜ ê±´ê°•ê³¼ í–‰ë³µ, ê·¸ë¦¬ê³  ì†Œì¤‘í•œ ì‚¬ëŒë“¤ì„ ìœ„í•´ 
                <span id="display-goal" style="color: #dc3545; font-weight: bold;">[ì™„ì „ ê¸ˆì£¼]</span>ë¥¼ ì‹¤ì²œí•  ê²ƒì„ ì•½ì†í•©ë‹ˆë‹¤. 
                ì•Œì½”ì˜¬ì€ [1ê¸‰ ë°œì•”ë¬¼ì§ˆ]ì„ì„ ì¸ì‹í•˜ê³ , ì˜¤ëŠ˜ë¶€í„° ê±´ê°•í•œ ì‚¶ì„ ë§Œë“¤ì–´ê°€ê² ìŠµë‹ˆë‹¤.
            </div>
            
            <p style="text-align: center; margin-bottom: 10px; font-weight: bold;">ì„œëª…í•˜ê¸°</p>
            <canvas id="signature-canvas"></canvas>
            <div class="signature-actions">
                <button onclick="clearSignature()">ì„œëª… ì§€ìš°ê¸°</button>
            </div>

            <button class="pledge-submit-btn" onclick="completePledge()">ì ˆì£¼ ì„œì•½ ì™„ë£Œ ë° ì €ì¥</button>
        </div>
    </div>

    <script>
        // --- íƒ­ ì´ë™ ê¸°ëŠ¥ ---
        // í€´ì¦ˆ ì™„ë£Œ ìƒíƒœì™€ AUDIT ì™„ë£Œ ìƒíƒœë¥¼ ì¶”ì í•˜ëŠ” ë³€ìˆ˜
        let isQuizCompleted = false; 
        let isAuditCompleted = false; 

        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;

            // ğŸš¨ ì ˆì£¼ ì„œì•½ íƒ­ í´ë¦­ ì‹œ ì¡°ê±´ ê²€ì‚¬ (ìˆ˜ì •ëœ ë¡œì§) ğŸš¨
            if (tabName === 'pledge') {
                if (!isQuizCompleted) {
                    alert("âš ï¸ ì ˆì£¼ ì„œì•½ì€ 'ìŒì£¼ ìƒì‹ í€´ì¦ˆ'ë¥¼ ë¨¼ì € ì™„ë£Œí•´ì•¼ í•©ë‹ˆë‹¤.");
                    return;
                }
                if (!isAuditCompleted) {
                    alert("âš ï¸ ì ˆì£¼ ì„œì•½ì€ 'ì•Œì½”ì˜¬ ì¤‘ë… ì„ ë³„ê²€ì‚¬(AUDIT)'ë¥¼ ë¨¼ì € ì™„ë£Œí•´ì•¼ í•©ë‹ˆë‹¤.");
                    return;
                }
            }

            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tab-button");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
            
            if (tabName === 'pledge') {
                initPledge();
            }
        }

        // --- 1. ìŒì£¼ ìƒì‹ í€´ì¦ˆ ë°ì´í„° ë° ë¡œì§ ---
        const quizData = [
            { q: "ì•Œì½”ì˜¬(ì—íƒ„ì˜¬)ì´ ê°„ì—ì„œ ë¶„í•´ë  ë•Œ ì£¼ë¡œ ìƒì„±ë˜ë©°, WHOê°€ ì§€ì •í•œ 1ê¸‰ ë°œì•”ë¬¼ì§ˆë¡œ ì•Œë ¤ì§„ ë¬¼ì§ˆì€?", options: ["1. ì—íƒ„ì˜¬", "2. ì•„ì„¸íŠ¸ì•Œë°íˆë“œ", "3. ì•„ì„¸íŠ¸ì‚°", "4. ë©”íƒ„ì˜¬"], answer: 1, rationale: "ì •ë‹µì€ ì•„ì„¸íŠ¸ì•Œë°íˆë“œì…ë‹ˆë‹¤. ì´ëŠ” ì•Œì½”ì˜¬ ë¶„í•´ ê³¼ì •ì—ì„œ ë°œìƒí•˜ëŠ” ê°•ë ¥í•œ ë…ì„± ë¬¼ì§ˆì´ì 1ê¸‰ ë°œì•”ë¬¼ì§ˆë¡œ, ìˆ™ì·¨ì™€ í™ì¡°ì˜ ì£¼ë²”ì…ë‹ˆë‹¤." },
            { q: "ì•„ì„¸íŠ¸ì•Œë°íˆë“œê°€ ì²´ë‚´ ì¶•ì ë˜ì§€ ì•ŠëŠ” ê²½ìš°ëŠ”?", options: ["ê³¼ìŒ", "í­ìŒ", "ì•„ì„¸íŠ¸ì•Œë°íˆë“œ ë¶„í•´íš¨ì†Œ ë¶€ì¡±", "ì ˆì£¼(ê¸ˆì£¼)"], answer: 3, rationale: "ì •ë‹µì€ ì ˆì£¼(ê¸ˆì£¼)ì…ë‹ˆë‹¤. ê³¼ìŒ, í­ìŒì‹œ ë¶„í•´ë˜ì§€ ëª»í•œ ì•„ì„¸íŠ¸ì•Œë°íˆë“œê°€ ê°„, ë‡Œ ë“± ì¡°ì§ì— ì¶•ì ë˜ì–´ ì†ìƒì„ ì¼ìœ¼í‚µë‹ˆë‹¤." },
            { q: "ì•„ì„¸íŠ¸ì•Œë°íˆë“œê°€ ì¸ì²´ì—ì„œ ìœ ë°œí•˜ëŠ” ê°€ì¥ ì‹¬ê°í•œ ë…ì„±ì‘ìš©ì€?", options: ["ì‹¬ê°í•œ íƒˆìˆ˜ ì¦ìƒ", "ë‘í†µ, ë©”ìŠ¤êº¼ì›€", "ì„¸í¬ì˜ DNAë¥¼ ì†ìƒì‹œì¼œ ì•” ë°œìƒ ìœ ë°œ", "ì¹¼ìŠ˜ í¡ìˆ˜ ë°©í•´ë¡œ ì¸í•œ ê³¨ë‹¤ê³µì¦"], answer: 2, rationale: "ì •ë‹µì€ ì„¸í¬ì˜ DNAë¥¼ ì†ìƒì‹œì¼œ ì•” ë°œìƒ ìœ ë°œì…ë‹ˆë‹¤. ì•„ì„¸íŠ¸ì•Œë°íˆë“œëŠ” DNAì— ì§ì ‘ ê²°í•©í•˜ì—¬ ëŒì—°ë³€ì´ë¥¼ ìœ ë°œí•¨ìœ¼ë¡œì¨ ì—¬ëŸ¬ ì¢…ë¥˜ì˜ ì•”ì„ ë°œìƒì‹œí‚µë‹ˆë‹¤." },
            { q: "ìˆ  ë§ˆì‹  í›„ ì–¼êµ´ í™ì¡°, ë‘í†µ, ì‹¬ì¥ ë°•ë™ ì¦ê°€ëŠ” ë¬´ì—‡ì´ ëª¸ì— ìŒ“ì—¬ ë³´ë‚´ëŠ” ìœ„í—˜ ì‹ í˜¸ì¸ê°€ìš”?", options: ["ì²´ë‚´ì˜ ì‹¬ê°í•œ ìˆ˜ë¶„ ë¶€ì¡±", "ë¶„í•´ë˜ì§€ ëª»í•˜ê³  ì¶•ì ëœ ì•„ì„¸íŠ¸ì•Œë°íˆë“œ", "ì•Œì½”ì˜¬ë¡œ ì¸í•œ ì¼ì‹œì  ë¹ˆí˜ˆ", "ê°„ì˜ ì§€ë°© ì¶•ì "], answer: 1, rationale: "ì •ë‹µì€ ë¶„í•´ë˜ì§€ ëª»í•˜ê³  ì¶•ì ëœ ì•„ì„¸íŠ¸ì•Œë°íˆë“œì…ë‹ˆë‹¤." },
            { q: "ë™ì–‘ì¸ì´ ì„œì–‘ì¸ë³´ë‹¤ ìˆ ì— ì·¨ì•½í•˜ê³  í™ì¡°ê°€ ì‰½ê²Œ ë‚˜íƒ€ë‚˜ëŠ” ì´ìœ ëŠ”?", options: ["ê°„ í¬ê¸°ê°€ ì‘ì•„ì„œ", "ì•„ì„¸íŠ¸ì•Œë°íˆë“œ ë¶„í•´íš¨ì†Œ(ALDH2)ê°€ ì ì–´ì„œ", "í¡ìˆ˜ ì†ë„ê°€ ë¹¨ë¼ì„œ", "í˜ˆê´€ì´ ì•½í•´ì„œ"], answer: 1, rationale: "ì •ë‹µì€ ì•„ì„¸íŠ¸ì•Œë°íˆë“œ ë¶„í•´íš¨ì†Œ(ALDH2)ê°€ ì ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë™ì•„ì‹œì•„ì¸ì˜ ì•½ 30~50%ê°€ ALDH2 ë³€ì´ ìœ ì „ìë¥¼ ê°€ì§€ê³  ìˆì–´ ì•„ì„¸íŠ¸ì•Œë°íˆë“œê°€ ì‰½ê²Œ ì²´ë‚´ì— ì¶•ì ë©ë‹ˆë‹¤." },
            { q: "ìˆ ì„ ìì£¼ ë§ˆì‹œë©´ ì£¼ëŸ‰ì´ ëŠ˜ì–´ë‚œë‹¤?", options: ["O", "X"], answer: 1, rationale: 'ì •ë‹µì€ "X"ì…ë‹ˆë‹¤. ì´ëŠ” ë‡Œì— ì•Œì½”ì˜¬ì— ëŒ€í•œ ë‚´ì„±ì´ ìƒê²¨ ë…ì„± ì‹ í˜¸ë¥¼ ëœ ëŠë¼ëŠ” ê²ƒì…ë‹ˆë‹¤. ë¶„í•´ ëŠ¥ë ¥ì€ ë³€í•¨ì´ ì—†ì–´ ì£¼ëŸ‰ì´ ëŠ˜ì—ˆë‹¤ ìƒê°í•œ ë§Œí¼ ë§ì€ ì•„ì„¸íŠ¸ì•Œë°íˆë“œ(ë…ì„±ë¬¼ì§ˆ)ê°€ ì²´ë‚´ ì¶•ì ë©ë‹ˆë‹¤.' },
            { q: "ì•Œì½”ì˜¬ ê±´ê°• ìœ„í—˜ì„ ìµœì†Œí™”í•˜ê³  ì•„ì„¸íŠ¸ì•Œë°íˆë“œ ì¶•ì ì„ ë§‰ëŠ” ê°€ì¥ ê·¼ë³¸ì  ë°©ë²•ì€?", options: ["ìˆ™ì·¨í•´ì†Œ ìŒë£Œë¥¼ ë§ˆì‹ ë‹¤", "ê¸°ë¦„ì§„ ì•ˆì£¼ë¥¼ ë¨¹ëŠ”ë‹¤", "ì‚¬ìš°ë‚˜ë¥¼ í•œë‹¤", "ì ˆì£¼(ê¸ˆì£¼)ë¥¼ ì‹¤ì²œí•œë‹¤"], answer: 3, rationale: "ì •ë‹µì€ ì ˆì£¼(ê¸ˆì£¼)ë¥¼ ì‹¤ì²œí•œë‹¤ì…ë‹ˆë‹¤." }
        ];

        let currentQuizIndex = 0;
        let correctAnswers = 0;
        let quizAnswered = false;
        
        function loadQuizQuestion(index) {
            const container = document.getElementById('quiz-container');
            if (index >= quizData.length) {
                showQuizResult();
                return;
            }

            const data = quizData[index];
            quizAnswered = false;
            
            let optionsHtml = '';
            data.options.forEach((option, i) => {
                optionsHtml += `<button data-index="${i}" onclick="checkQuizAnswer(${index}, ${i})">${option}</button>`;
            });

            container.innerHTML = `
                <div class="question-box">
                    <p>Q${index + 1}. ${data.q}</p>
                    <div class="options" id="quiz-options">${optionsHtml}</div>
                </div>
                <div id="quiz-feedback" style="display: none;"></div>
                <div class="action-container">
                    <button class="next-btn" id="quiz-next-btn" onclick="nextQuizQuestion()" style="display: none;">${index === quizData.length - 1 ? 'ê²°ê³¼ ë³´ê¸°' : 'ë‹¤ìŒ ë¬¸ì œ'}</button>
                </div>
            `;
        }

        function checkQuizAnswer(questionIndex, selectedIndex) {
            if (quizAnswered) return;
            quizAnswered = true;

            const data = quizData[questionIndex];
            const feedbackDiv = document.getElementById('quiz-feedback');
            const optionButtons = document.getElementById('quiz-options').querySelectorAll('button');
            const nextBtn = document.getElementById('quiz-next-btn');
            
            // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™” ë° ì„ íƒ í‘œì‹œ
            optionButtons.forEach(btn => {
                btn.disabled = true;
                if (parseInt(btn.getAttribute('data-index')) === selectedIndex) {
                    btn.classList.add('selected');
                }
            });

            // ì •ë‹µ í™•ì¸
            const isCorrect = selectedIndex === data.answer;
            if (isCorrect) {
                correctAnswers++;
                feedbackDiv.innerHTML = `<div class="result-message correct">âœ… ì •ë‹µì…ë‹ˆë‹¤!</div><div class="rationale">${data.rationale}</div>`;
            } else {
                feedbackDiv.innerHTML = `<div class="result-message incorrect">âŒ ì˜¤ë‹µì…ë‹ˆë‹¤. (ì •ë‹µ: ${data.options[data.answer].split('.')[0].trim()}ë²ˆ)</div><div class="rationale">${data.rationale}</div>`;
            }
            
            feedbackDiv.style.display = 'block';
            nextBtn.style.display = 'inline-block';
        }

        function nextQuizQuestion() {
            currentQuizIndex++;
            loadQuizQuestion(currentQuizIndex);
        }
        
        function showQuizResult() {
            const container = document.getElementById('quiz-container');
            const resultDiv = document.getElementById('quiz-final-result');
            let evaluation = '';

            if (correctAnswers === quizData.length) {
                evaluation = 'ğŸ‘ **ë§Œì !** ë‹¹ì‹ ì€ ì•Œì½”ì˜¬ ì „ë¬¸ê°€! ì´ë¯¸ ì ˆì£¼ì˜ í•„ìš”ì„±ì„ ì˜ ì•„ì‹œë‹ˆ ì‹¤ì²œë§Œ ë‚¨ì•˜ìŠµë‹ˆë‹¤.';
            } else if (correctAnswers >= 5) {
                evaluation = 'ğŸ‘ **ë§¤ìš° ìš°ìˆ˜!** ìŒì£¼ ìƒì‹ì„ ì˜ ì•Œê³  ê³„ì‹œë„¤ìš”. ì§€ì‹ì„ ì‹¤ì²œìœ¼ë¡œ ì´ì–´ê°€ì„¸ìš”!';
            } else if (correctAnswers >= 3) {
                evaluation = 'ğŸ¤” **ë³´í†µì…ë‹ˆë‹¤.** ëª‡ ê°€ì§€ ì˜¤í•´ê°€ ìˆë„¤ìš”. ì•Œì½”ì˜¬ì˜ ë…ì„± ìœ„í—˜ì„ ë‹¤ì‹œ í•œë²ˆ í™•ì¸í•´ë³´ì„¸ìš”.';
            } else {
                evaluation = 'âš ï¸ **ìœ„í—˜!** ì•Œì½”ì˜¬ì— ëŒ€í•œ ì˜ëª»ëœ ì§€ì‹ì´ ë§ìŠµë‹ˆë‹¤. ì•Œì½”ì˜¬ì€ 1ê¸‰ ë°œì•”ë¬¼ì§ˆì„ì„ ê¸°ì–µí•˜ê³ , ë°˜ë“œì‹œ ì ˆì£¼í•´ì•¼ í•©ë‹ˆë‹¤.';
            }

            isQuizCompleted = true; // â­ í€´ì¦ˆ ì™„ë£Œ ì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸

            container.style.display = 'none';
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <h2>ìµœì¢… í€´ì¦ˆ ê²°ê³¼</h2>
                <span class="health-center-info">ì œì£¼ì‹œ ì œì£¼ë³´ê±´ì†Œ</span>
                <div style="text-align: center; padding: 30px; border: 2px solid #007bff; border-radius: 10px; background-color: #f0f8ff;">
                    <p style="font-size: 2em; font-weight: bold; margin-bottom: 10px;">ì´ì : ${correctAnswers} / ${quizData.length}ì </p>
                    <p style="font-size: 1.5em; line-height: 1.5;">${evaluation}</p>
                    <button class="finish-btn" onclick="resetQuiz()">ë‹¤ì‹œí•˜ê¸°</button>
                </div>
            `;
        }

        function resetQuiz() {
            currentQuizIndex = 0;
            correctAnswers = 0;
            isQuizCompleted = false; // â­ ë‹¤ì‹œí•˜ê¸° ì‹œ ìƒíƒœ ì´ˆê¸°í™”
            document.getElementById('quiz-container').style.display = 'block';
            document.getElementById('quiz-final-result').style.display = 'none';
            loadQuizQuestion(currentQuizIndex);
        }
        
        // --- 2. AUDIT ì„ ë³„ê²€ì‚¬ ë°ì´í„° ë° ë¡œì§ ---
        const auditData = [
            { q: "Q1. ìˆ ì„ ì–¼ë§ˆë‚˜ ìì£¼ ë§ˆì‹­ë‹ˆê¹Œ?", options: ["ì „í˜€ ë§ˆì‹œì§€ ì•ŠëŠ”ë‹¤ (0ì )", "ì›” 1íšŒ ì´í•˜ (1ì )", "ì›” 2~4íšŒ (2ì )", "ì£¼ 2~3íšŒ (3ì )", "ì£¼ 4íšŒ ì´ìƒ (4ì )"] },
            { q: "Q2. ìˆ ì„ ë§ˆì‹œëŠ” ë‚ ì—ëŠ” ë³´í†µ ëª‡ ì”ì„ ë§ˆì‹­ë‹ˆê¹Œ(ìˆ ì¢…ë¥˜ì™€ ìƒê´€ì—†ì´ í•´ë‹¹ ìˆ ì˜ ì” ê¸°ì¤€)?", options: ["1~2ì” (0ì )", "3~4ì” (1ì )", "5~6ì” (2ì )", "7~9ì” (3ì )", "10ì” ì´ìƒ (4ì )"] },
            { q: "Q3. í•œ ë²ˆì˜ ìˆ ìë¦¬ì—ì„œ ì†Œì£¼ 1ë³‘ ë˜ëŠ” ë§¥ì£¼ 4ë³‘ ì´ìƒ ë§ˆì‹œëŠ” ê²½ìš°ëŠ” ì–¼ë§ˆë‚˜ ìì£¼ ìˆìŠµë‹ˆê¹Œ?", options: ["ì „í˜€ ì—†ë‹¤ (0ì )", "ì›” 1íšŒ ì´í•˜ (1ì )", "ì›” 2~4íšŒ (2ì )", "ì£¼ 1íšŒ (3ì )", "ê±°ì˜ ë§¤ì¼ ë˜ëŠ” ë§¤ì¼ (4ì )"] },
            { q: "Q4. ì§€ë‚œ 1ë…„ ë™ì•ˆ, ì¼ë‹¨ ìˆ ì„ ë§ˆì‹œê¸° ì‹œì‘í•˜ë©´ ëŠê¸°ê°€ ì–´ë ¤ì› ë˜ ì ì´ ì–¼ë§ˆë‚˜ ìì£¼ ìˆì—ˆìŠµë‹ˆê¹Œ?", options: ["ì „í˜€ ì—†ë‹¤ (0ì )", "ì›” 1íšŒ ì´í•˜ (1ì )", "ì›” 2~4íšŒ (2ì )", "ì£¼ 1íšŒ (3ì )", "ê±°ì˜ ë§¤ì¼ ë˜ëŠ” ë§¤ì¼ (4ì )"] },
            { q: "Q5. ì§€ë‚œ 1ë…„ ë™ì•ˆ, í‰ì†Œë³´ë‹¤ ìˆ  ë§ˆì‹  ë‹¤ìŒë‚  ì•„ì¹¨ì— í•´ì¥ìˆ ì„ ë§ˆì…”ì•¼ í–ˆë˜ ì ì´ ì–¼ë§ˆë‚˜ ìì£¼ ìˆì—ˆìŠµë‹ˆê¹Œ?", options: ["ì „í˜€ ì—†ë‹¤ (0ì )", "ì›” 1íšŒ ì´í•˜ (1ì )", "ì›” 2~4íšŒ (2ì )", "ì£¼ 1íšŒ (3ì )", "ê±°ì˜ ë§¤ì¼ ë˜ëŠ” ë§¤ì¼ (4ì )"] },
            { q: "Q6. ì§€ë‚œ 1ë…„ ë™ì•ˆ, ìˆ ì„ ë§ˆì‹  í›„ ìˆ™ì·¨ ë“±ìœ¼ë¡œ ì¸í•´ í‰ì†Œ í•˜ë˜ ì¼ì— ì§€ì¥ì´ ìˆì—ˆë˜ ì ì´ ì–¼ë§ˆë‚˜ ìì£¼ ìˆì—ˆìŠµë‹ˆê¹Œ?", options: ["ì „í˜€ ì—†ë‹¤ (0ì )", "ì›” 1íšŒ ì´í•˜ (1ì )", "ì›” 2~4íšŒ (2ì )", "ì£¼ 1íšŒ (3ì )", "ê±°ì˜ ë§¤ì¼ ë˜ëŠ” ë§¤ì¼ (4ì )"] },
            { q: "Q7. ì§€ë‚œ 1ë…„ ë™ì•ˆ, ìˆ ì„ ë§ˆì‹  í›„ í›„íšŒí•˜ê±°ë‚˜ ì£„ì±…ê°ì„ ëŠê¼ˆë˜ ì ì´ ì–¼ë§ˆë‚˜ ìì£¼ ìˆì—ˆìŠµë‹ˆê¹Œ?", options: ["ì „í˜€ ì—†ë‹¤ (0ì )", "ì›” 1íšŒ ì´í•˜ (1ì )", "ì›” 2~4íšŒ (2ì )", "ì£¼ 1íšŒ (3ì )", "ê±°ì˜ ë§¤ì¼ ë˜ëŠ” ë§¤ì¼ (4ì )"] },
            { q: "Q8. ì§€ë‚œ 1ë…„ ë™ì•ˆ, ìˆ  ë•Œë¬¸ì— ê¸°ì–µì´ ëŠê¸´ ì (í•„ë¦„ì´ ëŠê¸´ ì )ì´ ì–¼ë§ˆë‚˜ ìì£¼ ìˆì—ˆìŠµë‹ˆê¹Œ?", options: ["ì „í˜€ ì—†ë‹¤ (0ì )", "ì›” 1íšŒ ì´í•˜ (1ì )", "ì›” 2~4íšŒ (2ì )", "ì£¼ 1íšŒ (3ì )", "ê±°ì˜ ë§¤ì¼ ë˜ëŠ” ë§¤ì¼ (4ì )"] },
            { q: "Q9. ìˆ  ë§ˆì‹œëŠ” ê²ƒ ë•Œë¬¸ì— ë³¸ì¸ì´ë‚˜ ë‹¤ë¥¸ ì‚¬ëŒì´ ë‹¤ì¹œ ì ì´ ìˆì—ˆìŠµë‹ˆê¹Œ?", options: ["ì—†ë‹¤ (0ì )", "ìˆë‹¤ (4ì )"] },
            { q: "Q10. ìˆ  ë§ˆì‹œëŠ” ê²ƒ ë•Œë¬¸ì— ê°€ì¡±ì´ë‚˜ ì¹œêµ¬, ì˜ì‚¬ ë“±ì´ ê±±ì •í•˜ê±°ë‚˜ ì¡°ì–¸í•œ ì ì´ ìˆì—ˆìŠµë‹ˆê¹Œ?", options: ["ì—†ë‹¤ (0ì )", "ìˆë‹¤ (4ì )"] }
        ];
        
        let currentAuditIndex = 0;
        let auditScores = new Array(auditData.length).fill(0);
        let userGender = null; // 'M' or 'F'

        function setGender(gender, button) {
            userGender = gender;
            document.querySelectorAll('.gender-select button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            document.getElementById('audit-intro').style.display = 'none';
            document.getElementById('audit-container').style.display = 'block';
            loadAuditQuestion(currentAuditIndex);
        }

        function loadAuditQuestion(index) {
            const container = document.getElementById('audit-container');
            if (index >= auditData.length) {
                showAuditResult();
                return;
            }

            const data = auditData[index];
            let optionsHtml = '';

            // Q9, Q10ì€ 0ì /4ì  êµ¬ì„±, ë‚˜ë¨¸ì§€ëŠ” 0ì ~4ì 
            const isBinary = index >= 8; 

            data.options.forEach((option, i) => {
                const score = isBinary ? (i === 0 ? 0 : 4) : i; // 0, 1, 2, 3, 4
                optionsHtml += `<button data-score="${score}" onclick="selectAuditAnswer(${index}, ${score}, this)">${option}</button>`;
            });

            container.innerHTML = `
                <div class="question-box">
                    <p>${data.q}</p>
                    <div class="options" id="audit-options">${optionsHtml}</div>
                </div>
                <div class="action-container" style="text-align: center;">
                    <button class="next-btn" id="audit-next-btn" onclick="nextAuditQuestion()" style="display: none;">${index === auditData.length - 1 ? 'ê²°ê³¼ ë³´ê¸°' : 'ë‹¤ìŒ ë¬¸í•­'}</button>
                </div>
            `;
        }

        function selectAuditAnswer(questionIndex, score, button) {
            // ì´ì „ì— ì„ íƒëœ ë²„íŠ¼ì˜ ìŠ¤íƒ€ì¼ì„ ì œê±°
            document.getElementById('audit-options').querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            
            // í˜„ì¬ ì„ íƒëœ ë²„íŠ¼ì— ìŠ¤íƒ€ì¼ ì ìš©
            button.classList.add('selected');
            
            // ì ìˆ˜ ì €ì¥
            auditScores[questionIndex] = score;

            // ë‹¤ìŒ ë²„íŠ¼ í™œì„±í™”
            document.getElementById('audit-next-btn').style.display = 'inline-block';
        }

        function nextAuditQuestion() {
            // ë‹¤ìŒ ë¬¸í•­ìœ¼ë¡œ ë„˜ì–´ê°€ê¸° ì „ í˜„ì¬ ë¬¸í•­ì´ ë‹µë³€ë˜ì—ˆëŠ”ì§€ í™•ì¸ (ì„ íƒëœ ë²„íŠ¼ì´ ìˆëŠ”ì§€ í™•ì¸)
            if (document.getElementById('audit-options').querySelector('.selected') === null) {
                alert('ë¬¸í•­ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.');
                return;
            }
            currentAuditIndex++;
            loadAuditQuestion(currentAuditIndex);
        }
        
        function showAuditResult() {
            const totalScore = auditScores.reduce((a, b) => a + b, 0);
            let assessment = '';
            let recommendation = '';
            let scoreThreshold;

            if (userGender === 'M') { // ë‚¨ì„± ê¸°ì¤€
                if (totalScore >= 20) {
                    scoreThreshold = '20ì  ì´ìƒ';
                    assessment = 'ì•Œì½”ì˜¬ ë‚¨ìš© ë˜ëŠ” ì˜ì¡´ë‹¨ê³„';
                    recommendation = 'ì•Œì½”ì˜¬ ì‚¬ìš© ì¥ì• ê°€ ì˜ì‹¬ë©ë‹ˆë‹¤. ìˆ ì„ ë§ˆì…”ì•¼ ê¸°ë¶„ë„ ì¢‹ê³ , ì¼ë„ ì˜ë˜ê³ , ê´€ê³„ë„ ì¢‹ì•„ì§„ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. ìˆ ì„ ì¤„ì´ëŠ” ë‹¨ê³„ê°€ ì•„ë‹ˆë¼ ëŠì–´ì•¼ í•©ë‹ˆë‹¤.';
                } else if (totalScore >= 10) {
                    scoreThreshold = '10~19ì ';
                    assessment = 'ìœ„í—˜ ìŒì£¼êµ°';
                    recommendation = 'ìŒì£¼ëŸ‰ì„ ì¤„ì´ëŠ” ë…¸ë ¥ì´ í•„ìš”í•©ë‹ˆë‹¤. ì ˆì£¼ ìƒë‹´ ë° êµìœ¡ì„ ê¶Œê³ í•©ë‹ˆë‹¤.';
                } else {
                    scoreThreshold = '0~9ì ';
                    assessment = 'ì €ìœ„í—˜êµ°';
                    recommendation = 'ê±´ê°•í•œ ìŒì£¼ ìŠµê´€ì„ ìœ ì§€í•˜ì„¸ìš”.';
                }
            } else { // ì—¬ì„± ê¸°ì¤€
                if (totalScore >= 10) {
                    scoreThreshold = '10ì  ì´ìƒ';
                    assessment = 'ì•Œì½”ì˜¬ ë‚¨ìš© ë˜ëŠ” ì˜ì¡´ë‹¨ê³„';
                    recommendation = 'ì•Œì½”ì˜¬ ì‚¬ìš© ì¥ì• ê°€ ì˜ì‹¬ë©ë‹ˆë‹¤. ìˆ ì„ ë§ˆì…”ì•¼ ê¸°ë¶„ë„ ì¢‹ê³ , ì¼ë„ ì˜ë˜ê³ , ê´€ê³„ë„ ì¢‹ì•„ì§„ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. ìˆ ì„ ì¤„ì´ëŠ” ë‹¨ê³„ê°€ ì•„ë‹ˆë¼ ëŠì–´ì•¼ í•©ë‹ˆë‹¤.';
                } else if (totalScore >= 6) {
                    scoreThreshold = '6~9ì ';
                    assessment = 'ìœ„í—˜ ìŒì£¼êµ°';
                    recommendation = 'ìŒì£¼ëŸ‰ì„ ì¤„ì´ëŠ” ë…¸ë ¥ì´ í•„ìš”í•©ë‹ˆë‹¤. ì ˆì£¼ ìƒë‹´ ë° êµìœ¡ì„ ê¶Œê³ í•©ë‹ˆë‹¤.';
                } else {
                    scoreThreshold = '0~5ì ';
                    assessment = 'ì €ìœ„í—˜êµ°';
                    recommendation = 'ê±´ê°•í•œ ìŒì£¼ ìŠµê´€ì„ ìœ ì§€í•˜ì„¸ìš”.';
                }
            }

            isAuditCompleted = true; // â­ AUDIT ì™„ë£Œ ì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸

            const container = document.getElementById('audit-container');
            const resultDiv = document.getElementById('audit-final-result');
            
            container.style.display = 'none';
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <h2>AUDIT ê²€ì‚¬ ê²°ê³¼</h2>
                <span class="health-center-info">ì œì£¼ì‹œ ì œì£¼ë³´ê±´ì†Œ</span>
                <div style="text-align: center; padding: 30px; border: 2px solid #dc3545; border-radius: 10px; background-color: #f8e9eb;">
                    <p style="font-size: 1.5em; font-weight: bold; margin-bottom: 5px;">ì„±ë³„: ${userGender === 'M' ? 'ë‚¨ì„±' : 'ì—¬ì„±'}</p>
                    <p style="font-size: 2em; font-weight: bold; margin-bottom: 20px;">ì´ì : <span style="color: #dc3545;">${totalScore}</span>ì </p>
                    <p style="font-size: 1.8em; font-weight: bold; color: #007bff; margin-bottom: 15px;">íŒì •: ${assessment}</p>
                    <p style="font-size: 1.2em; line-height: 1.6;">**ê¶Œê³ ì‚¬í•­:** ${recommendation}</p>
                    <p style="font-size: 0.9em; margin-top: 15px; color: #6c757d;">(ì°¸ê³ : ${userGender === 'M' ? 'ë‚¨ì„±' : 'ì—¬ì„±'} ${scoreThreshold} ${assessment} ê¸°ì¤€ì…ë‹ˆë‹¤.)</p>
                    <button class="finish-btn" onclick="resetAudit()">ë‹¤ì‹œí•˜ê¸°</button>
                </div>
            `;
        }

        function resetAudit() {
            currentAuditIndex = 0;
            auditScores = new Array(auditData.length).fill(0);
            userGender = null;
            isAuditCompleted = false; // â­ ë‹¤ì‹œí•˜ê¸° ì‹œ ìƒíƒœ ì´ˆê¸°í™”
            document.getElementById('audit-intro').style.display = 'block';
            document.getElementById('audit-container').style.display = 'none';
            document.getElementById('audit-final-result').style.display = 'none';
            document.querySelectorAll('.gender-select button').forEach(btn => btn.classList.remove('selected'));
        }
        
        // --- 3. ì ˆì£¼ ì„œì•½ ë¡œì§ (ì„œëª… ê¸°ëŠ¥ í¬í•¨) ---
        let signaturePad;
        let pledgeCanvas; 

        function initPledge() {
            // 1. ì„œì•½ ë‚ ì§œ ìë™ ìƒì„±
            const today = new Date();
            const dateString = `${today.getFullYear()}ë…„ ${today.getMonth() + 1}ì›” ${today.getDate()}ì¼`;
            document.getElementById('pledge-date').textContent = dateString;

            // 2. ëª©í‘œ ë³€ê²½ ì‹œ ì„œì•½ ë¬¸êµ¬ ì—…ë°ì´íŠ¸
            const goalSelect = document.getElementById('goal-select');
            const displayGoal = document.getElementById('display-goal');
            
            // ì´ˆê¸° ë¬¸êµ¬ ì„¤ì •
            displayGoal.textContent = goalSelect.value;
            
            goalSelect.onchange = function() {
                displayGoal.textContent = this.value;
            };

            // 3. ì„œëª… íŒ¨ë“œ ì´ˆê¸°í™”
            const canvas = document.getElementById('signature-canvas');
            pledgeCanvas = canvas; 
            // ìº”ë²„ìŠ¤ì˜ í¬ê¸°ë¥¼ ë¶€ëª¨ ìš”ì†Œì— ë§ê²Œ ì¡°ì •
            function resizeCanvas() {
                const ratio = Math.max(window.devicePixelRatio || 1, 1);
                canvas.width = canvas.offsetWidth * ratio;
                canvas.height = canvas.offsetHeight * ratio;
                canvas.getContext("2d").scale(ratio, ratio);
                
                if (signaturePad) {
                    signaturePad.clear();
                }
            }
            window.onresize = resizeCanvas;
            resizeCanvas();

            // SignaturePad ê°ì²´ ìƒì„±
            signaturePad = new SignaturePad(canvas, {
                backgroundColor: 'rgb(255, 255, 255)' 
            });
        }
        
        function clearSignature() {
            if (signaturePad) {
                signaturePad.clear();
            }
        }
        
        function completePledge() {
            if (signaturePad && signaturePad.isEmpty()) {
                alert("ì„œëª…ë€ì— ì„œëª…ì„ í•´ì£¼ì„¸ìš”.");
                return;
            }

            // â­â­ ìˆ˜ì •ëœ ë¶€ë¶„: ì„œì•½ì ì´ë¦„/ë³„ëª… ê°€ì ¸ì˜¤ê¸° ë° ìœ íš¨ì„± ê²€ì‚¬ â­â­
            const name = document.getElementById('signer-name').value.trim();
            if (!name) {
                alert("ì„œì•½ì ì´ë¦„ ë˜ëŠ” ë³„ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }
            // â­â­ ìˆ˜ì •ëœ ë¶€ë¶„ ë â­â­

            const goal = document.getElementById('goal-select').value;
            const date = document.getElementById('pledge-date').textContent;
            
            // ì„œëª… ì´ë¯¸ì§€ë¥¼ ë°ì´í„° URLë¡œ ê°€ì ¸ì˜¤ê¸° 
            const signatureDataUrl = signaturePad.toDataURL(); 

            // ê²°ê³¼ ë©”ì‹œì§€ í‘œì‹œ
            const formDiv = document.getElementById('pledge-form');
            const completeDiv = document.getElementById('pledge-complete-message');
            
            formDiv.style.display = 'none';
            completeDiv.style.display = 'block';
            // â­â­ ìˆ˜ì •ëœ ë¶€ë¶„: ë©”ì‹œì§€ì— ì´ë¦„ê³¼ ì„œëª… ì´ë¯¸ì§€ ì¶”ê°€ â­â­
            completeDiv.innerHTML = `
                ğŸ‰ **${name}ë‹˜ì˜ ê±´ê°•í•œ ë‹¤ì§ì„ ì¶•í•˜í•©ë‹ˆë‹¤!**
                <br><br>
                ${date} ìë¡œ **${goal}** ì„œì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
                <br>
                ì§€ê¸ˆ ë°”ë¡œ ê±´ê°•í•œ ë³€í™”ë¥¼ ì‹œì‘í•˜ì„¸ìš”!
                <p style="font-size: 1em; margin-top: 20px; font-weight: bold;">[${name}ë‹˜ì˜ ì„œëª… í™•ì¸]</p>
                <img src="${signatureDataUrl}" alt="ì„œëª… ì´ë¯¸ì§€" style="border: 1px solid #ced4da; max-width: 100%; height: auto; background-color: white; margin-top: 10px; width: 250px; height: 100px; object-fit: contain;">
                <button class="finish-btn" style="margin-top: 20px; float: none;" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ</button>
            `;
            // â­â­ ìˆ˜ì •ëœ ë¶€ë¶„ ë â­â­
            
            // ì„œëª… íŒ¨ë“œ ë¹„í™œì„±í™”
            if (pledgeCanvas) {
                pledgeCanvas.style.pointerEvents = 'none';
            }
            signaturePad = null;
        }

        // ì•± ë¡œë“œ ì‹œ í€´ì¦ˆ íƒ­ì„ ê¸°ë³¸ìœ¼ë¡œ ì„¤ì •
        window.onload = function() {
            loadQuizQuestion(currentQuizIndex);
            initPledge(); 
        }

    </script>
</body>
</html>